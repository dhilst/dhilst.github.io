---
layout: post
title: compiling the kernel
date: '2010-08-30T19:37:00.001-07:00'
author: Daniel Hilst
blogger: true
tags: 
modified_time: '2010-08-30T19:48:27.377-07:00'
blogger_id: tag:blogger.com,1999:blog-8785437776394405849.post-7862199046523097802
blogger_orig_url: http://gkos-hw.blogspot.com/2010/08/compiling-kernel.html
---

<pre class="brush: bash">#!/bin/bash<br /><br /># This script will download, check, compile and install modules of a chosen kernel<br /># at a setted directory. You must suply your password for root needed<br /># actions<br /> <br /># set variables<br />VERSION='2.6.35.4' # what is the kernel version<br />UNPACKDIR=/usr/src/ # where to unpack<br />EXTENSION=tar.bz2 # the kernel extension<br />RC=1 # this will be incremented at every compile<br />TARGET=/home/geckos/projects/goot # where to copy kernel<br />T_ROOT=${TARGET}/root # where to install modules<br /># stop here<br /><br />SRC=linux-${VERSION}<br />SRCDIR=${UNPACKDIR}${SRC}<br />SRCFILE="${SRC}.${EXTENSION}"<br />CHECKSUM="${SRCFILE}.sign"<br />LINUX_URL="ftp://ftp.kernel.org/pub/linux/kernel/v2.6"<br />MAKEOPTION="menuconfig"<br /><br />for ARG in $@; do<br /> case $ARG in<br /> makeopt=*) <br />  MAKEOPTION=`echo $ARG | cut -f2 -d=`<br /> ;;<br /> unpack)<br />  sudo rm ${SRCDIR} -r<br /> ;;<br /> download)<br />  rm ${SRCFILE} ${CHECKSUM}<br /> ;;<br /> esac<br />done<br />  <br /># check source<br />chk_src () {<br /> echo "Checking source ..."<br /> if [ ! -d "${SRCDIR}" ]; then<br />  if [ ! -r "${SRCFILE}" ]; then<br />   wget -c "${LINUX_URL}/${SRCFILE}" || return 1<br />  fi<br />  if [ ! -r "${CHECKSUM}" ]; then<br />   wget -c "${LINUX_URL}/${CHECKSUM}" || return 1<br /><br />  fi<br />  gpg2 --keyserver wwwkeys.pgp.net --recv-keys 0x517D0F0E <br />  gpg2 --verify ${CHECKSUM} ${SRCFILE} || return 1 <br />  sudo tar vxf ${SRCFILE} -C ${UNPACKDIR} && return 0 || return 1<br /> fi<br /> echo "DONE"<br /> return 0<br />}<br /><br /># build kernel<br />build () {<br /> echo "Starting build ..."<br /> # to install modules at target<br /> export INSTALL_MOD_PATH=${T_ROOT}<br /> { sudo make -C ${SRCDIR} mrproper ; } &&<br /> { sudo make -C ${SRCDIR} ${MAKEOPTION}; } &&<br /> { sudo make -C ${SRCDIR}; } &&<br /> { sudo make -C ${SRCDIR} modules_install; } || return 1;<br /> echo "DONE"<br />}<br /><br /># copy files<br />cpy_files () {<br /> echo "Copying files..."<br /> cp ${SRCDIR}/arch/x86/boot/bzImage ${TARGET}vmlinuz-${VERSION} -v;<br /> cp ${SRCDIR}/.config ${TARGET}config-${VERSION} -v;<br /> echo "DONE"<br />}<br /><br /># increment the RC of this file at every execution <br />inc_rc () {<br /> N=`sed -n 's|^RC=\([0-9]\{1,2\}\)$|\1|p' $0`<br /> let N++<br /> sed -e "s|^RC=.*$|RC=$N|" -i $0<br />}<br /><br /># main<br />echo "Start.."<br />{<br /> chk_src &&<br /> build &&<br /> cpy_files &&<br /> inc_rc<br />} &&<br />echo "Finish" || echo "Fails"<br /></pre>