---
layout: post
title: Revised tree
date: '2011-01-09T19:41:00.000-08:00'
author: Daniel Hilst
blogger: true
tags: 
modified_time: '2011-01-09T19:41:31.146-08:00'
blogger_id: tag:blogger.com,1999:blog-8785437776394405849.post-6061836702010114437
blogger_orig_url: http://gkos-hw.blogspot.com/2011/01/revised-tree.html
---

I have to make some changes in tree.c and tree.h, so del_branch<br />can be implemented easily! <br /><br />Code:<br /><br />tree.h<br /><pre class="brush: c">#ifndef GKO_TREE_H<br />#define GKO_TREE_H<br /><br />#include "stack.h"<br />#include "common.h"<br /><br />struct branch {<br />    char *name;<br />    char *data;<br />    struct branch *cont;<br />    struct branch *next;<br />} branch;<br />    <br /><br />void init_tree (struct branch *,  char *,  char *) ;<br />void set_branch (struct branch *,  char *,  char *);<br />struct branch * get_branch (struct branch *,  char *);<br />void del_branch (struct branch *);<br /><br />#endif<br /><br /></pre><br />tree.c<br /><pre class="brush: c">#include "tree.h"<br /><br />/* Initialize a Tree, set the root node */<br />void<br />init_tree (struct branch *t, char *name, char *data) <br />{<br />    cpystr (&t-&gt;name, name);<br />    cpystr (&t-&gt;data, data);<br />    t-&gt;cont = NULL;<br />    t-&gt;next = NULL;<br />}<br /><br />/* Create a new struct branch or edit an existent one */<br />void<br />set_branch (struct branch *t, char *name, char *data)<br />{<br />    struct branch *b;<br />    struct branch *prior;<br /><br />    if (!t || !name || !data)<br />        pexit ("set_branch: NULL argument call\n");<br /><br />    for (b = t-&gt;cont, prior = NULL; b; prior = b, b = b-&gt;next) {<br />        if (! strcmp (b-&gt;name, name)) {<br />            free (b-&gt;data);<br />            cpystr (&b-&gt;data, data);<br />            return;<br />        }<br />    }<br /><br />    b = xmalloc (sizeof (struct branch));<br />    init_tree (b, name, data);<br />    if (!prior) /* if there is no content in branch *t, the prior remains NULL */<br />        t-&gt;cont = b;<br />    else<br />        prior-&gt;next = b;<br />}<br /><br />/* Return the address of a struct branch */<br />struct branch *<br />get_branch (struct branch *t, char *name)<br />{<br />    struct branch *b;<br />    <br />    if (!t || !name)<br />        pexit ("get_brach: NULL argument call\n");<br /><br />    for (b = t-&gt;cont; b; b = b-&gt;next)<br />        if (! strcmp (b-&gt;name, name))<br />            return b;<br />    <br />    return NULL;<br />}<br /><br /><br />/* Delete a struct branch an everything below that node */<br />void<br />del_branch (struct branch *t)<br />{<br />    if (t-&gt;cont) <br />        del_branch (t-&gt;cont);<br /><br />    if  (t-&gt;next)<br />        del_branch (t-&gt;next);<br />    <br />    free (t-&gt;name);<br />    free (t-&gt;data);<br />    free (t);<br />}<br /><br /></pre><br />common.c<br /><pre class="brush: c">#include "common.h"<br /><br />void<br />pexit (const char *msg)<br />{<br />    perror (msg);<br />    exit (EXIT_FAILURE);<br />} <br />    <br />void *<br />xmalloc (size_t siz)<br />{<br />    void *n = malloc (siz);<br />    if (!n) <br />        pexit ("malloc");<br />    return n;<br />}<br /><br />void<br />cpystr (char **dst, char *src)<br />{<br />    int len = strlen (src) + 1;<br />    *dst = xmalloc (len);<br />    strncpy (*dst, src, len); <br />}<br /><br /></pre><br />test.c<br /><pre class="brush: c">#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;string.h&gt;<br /><br />#include "tree.h"<br /><br />main ()<br />{<br />    struct branch *myt = xmalloc (sizeof (struct branch));<br />    struct branch *buf;<br /><br />    init_tree (myt, "root", "root_data");<br />    set_branch (myt, "etc", "etc_data");<br />    set_branch (myt, "usr", "usr_data");<br />    buf = get_branch (myt, "etc");<br />    set_branch (buf, "rc.conf", "rc.conf data");<br />    set_branch (myt, "etc", "etc_edited_data");<br /><br />    del_branch (myt);<br />    return 0;<br />}<br /><br /></pre>