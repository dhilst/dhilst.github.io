---
layout: post
title: Finances control n00b program
date: '2010-03-02T16:55:00.000-08:00'
author: Daniel Hilst
blogger: true
tags: 
modified_time: '2010-03-02T17:04:38.631-08:00'
blogger_id: tag:blogger.com,1999:blog-8785437776394405849.post-3617063020675358248
blogger_orig_url: http://gkos-hw.blogspot.com/2010/03/finances-control-n00b-program.html
---

I have nothing to do.. so I make a program to take note of my money<br />It's poor... but fun...<br />sample output:<br /><br /><pre class="nerd">~:$./gkmoney <br />no arguments<br />Current balance: 216<br />dep 17000  sell a hello world for 17k<br />wit 1500 purchase a old beatle<br />wit 3 beatle crash .. I went back by bus<br />end<br /><br />Tue Mar&nbsp; 2 21:53:18 2010&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp; 17000 -&gt; 17216 sell a hello world for 17k<br />Tue Mar&nbsp; 2 21:53:34 2010&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1500 -&gt; 15716 purchase a old beatle <br />Tue Mar&nbsp; 2 21:53:55 2010&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 -&gt; 15713 beatle crash .. I went back by bus<br />Current Balance: 15713<br /></pre><br /><br />source code<br /><br /><pre class="brush:c">#include &lt;stdlib.h&gt;<br />#include &lt;stdio.h&gt;<br />#include &lt;string.h&gt;<br />#include &lt;time.h&gt;<br /><br />int<br />main (int argc, char ** argv)<br />{<br />&nbsp; FILE * bf;<br />&nbsp; FILE * lf;<br />&nbsp; int balance, val, indx, n;<br />&nbsp; char buf[BUFSIZ];<br />&nbsp; char command[5], * time_str, comment[255];<br />&nbsp; time_t time_now;<br /><br />&nbsp; if (argc &lt; 2) {<br />&nbsp;&nbsp;&nbsp; printf ("no arguments\n");<br />&nbsp;&nbsp;&nbsp; bf = fopen ("/home/geckos/.bl.txt", "r+");<br />&nbsp;&nbsp;&nbsp; lf = fopen ("/home/geckos/.ml.txt", "a+");<br />&nbsp; }<br />&nbsp; else {<br />&nbsp;&nbsp;&nbsp; bf = fopen (argv[1], "r+");<br />&nbsp;&nbsp;&nbsp; lf = fopen (argv[2], "a+");<br />&nbsp; }<br /><br />&nbsp; if (bf == NULL<br />&nbsp;&nbsp;&nbsp; &nbsp; || lf == NULL) {<br />&nbsp;&nbsp;&nbsp; perror ("fopen");<br />&nbsp;&nbsp;&nbsp; exit (1);<br />&nbsp; }<br />&nbsp; <br />&nbsp; if (fscanf (bf, "%d\n", &amp;balance) == EOF) {<br />&nbsp;&nbsp;&nbsp; perror ("fscanf");<br />&nbsp;&nbsp;&nbsp; exit (1);<br />&nbsp; }<br />&nbsp; printf ("Current balance: %d\n", balance);<br />&nbsp; <br />&nbsp; while (1) {<br />&nbsp;&nbsp;&nbsp; for (indx = 0; indx &lt; BUFSIZ; indx++) {<br />&nbsp;&nbsp;&nbsp; &nbsp; char ch;<br />&nbsp;&nbsp;&nbsp; &nbsp; n = read (0, &amp;ch, 1);<br />&nbsp;&nbsp;&nbsp; &nbsp; if (n == -1) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; perror ("read");<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; exit (1);<br />&nbsp;&nbsp;&nbsp; &nbsp; }<br />&nbsp;&nbsp;&nbsp; &nbsp; if (ch == '\n')<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp; &nbsp; buf[indx] = ch;<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; buf[indx] = '\0';<br />&nbsp;&nbsp;&nbsp; /* %[^-] = %s + white spaces */<br />&nbsp;&nbsp;&nbsp; n = sscanf (buf, "%s %d %[^-]", command, &amp;val, comment); <br />&nbsp;&nbsp;&nbsp; time_now = time (NULL);<br />&nbsp;&nbsp;&nbsp; time_str = ctime (&amp;time_now);<br />&nbsp;&nbsp;&nbsp; time_str[strlen (time_str) - 1] = '\0'; /* chop LF */<br />&nbsp;&nbsp;&nbsp; if (n == 2)<br />&nbsp;&nbsp;&nbsp; &nbsp; memcpy (comment, "...", 4);<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; if (strcmp (command, "dep") == 0) {<br />&nbsp;&nbsp;&nbsp; &nbsp; balance += val;<br />&nbsp;&nbsp;&nbsp; &nbsp; fprintf (lf, "%s\t+%10d -&gt; %10d\t%s\n", time_str, val, balance, comment);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; else if (strcmp (command, "wit") == 0) {<br />&nbsp;&nbsp;&nbsp; &nbsp; balance -= val;<br />&nbsp;&nbsp;&nbsp; &nbsp; fprintf (lf, "%s\t-%10d -&gt; %10d\t%s\n", time_str, val, balance, comment);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; else if (strcmp (command, "end") == 0)<br />&nbsp;&nbsp;&nbsp; &nbsp; break;<br />&nbsp; }&nbsp;&nbsp;&nbsp; <br />&nbsp; fseek (bf, 0, SEEK_SET);<br />&nbsp; fprintf (bf, "%d", balance);<br />&nbsp; fclose (bf);<br />&nbsp; fseek (lf, 0, SEEK_SET);<br />&nbsp; while (fgets (buf, BUFSIZ, lf))<br />&nbsp;&nbsp;&nbsp; printf ("%s", buf);<br />&nbsp; fclose (lf);<br />&nbsp; printf ("Current Balance: %d\n", balance);<br />&nbsp; return 0;<br />}</pre>