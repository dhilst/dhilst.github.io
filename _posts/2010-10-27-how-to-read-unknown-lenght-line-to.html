---
layout: post
title: How to read an unknown lenght line to a string in C
date: '2010-10-27T15:33:00.000-07:00'
author: Daniel Hilst
tags: 
modified_time: '2010-10-27T19:17:50.021-07:00'
blogger_id: tag:blogger.com,1999:blog-8785437776394405849.post-1762976257622073714
blogger_orig_url: http://gkos-hw.blogspot.com/2010/10/how-to-read-unknown-lenght-line-to.html
---

<pre class="brush: c">/*===========================*<br /> *    Reading dinamically    *<br /> *===========================*/<br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br /><br />#define DATALEN BUFSIZ <br /><br />struct block {<br />    char data[DATALEN];<br />    struct block *next;<br />};<br /><br />struct block *<br />alloc_block (void)<br />{<br />    struct block *new = malloc (sizeof (struct block));<br />    if (!new) {<br />        perror ("malloc");<br />        exit (EXIT_FAILURE);<br />    }<br />    return new;<br />}<br /><br />int<br />readfrom (char **str, FILE *stream, int finalchar)<br />{<br />    struct block *first;<br />    struct block *ptr;<br />    struct block *prev;<br />    struct block *tmp;<br />    int ch, indx = 0, nblocks = 1, strindx;<br /><br />    first = ptr = alloc_block();<br />    ptr-&gt;next = NULL;<br />    /* read and alloc string as a linked list */<br />    while ((ch = getc(stream)) != finalchar) {<br />        if (indx == DATALEN) {<br />            tmp = alloc_block ();<br />            indx = 0; <br />            nblocks++;<br />            tmp-&gt;next = NULL;<br />            ptr-&gt;next = tmp;<br />            ptr = tmp;<br />        } else if (indx &gt; DATALEN) {<br />            fprintf (stderr, "readline error: Index error\n");<br />            exit (EXIT_FAILURE);<br />        }<br />        ptr-&gt;data[indx++] = ch;<br />    }<br />    ptr-&gt;data[indx] = '\0';<br />    *str = malloc ( (nblocks - 1) * DATALEN + indx );    <br />    /* run in list freeing it */<br />    for <br />    (ptr = first, strindx = 0; <br />     ptr != NULL; <br />     prev = ptr, ptr = ptr-&gt;next, free (prev)) <br />    {<br />        for <br />        (indx = 0; <br />         indx &lt; DATALEN && ptr-&gt;data[indx] != '\0'; <br />         indx++, strindx++) <br />        {<br />            (*str)[strindx] = ptr-&gt;data[indx]; <br />        }<br />    }<br />    (*str)[strindx] = '\0';<br />    return strindx;<br />}<br /><br />        <br />int<br />main (void)<br />{<br />    char *str;<br />    int len;<br />    len = readfrom (&str, stdin, '\n');<br />    printf ("Your string with len %d is `%s'\n", len, str);<br />    return 0;<br />}<br /><br /></pre>