---
layout: post
title: listen for browser
date: '2009-12-29T17:13:00.000-08:00'
author: Daniel Hilst
blogger: true
tags: 
modified_time: '2009-12-30T06:08:45.245-08:00'
blogger_id: tag:blogger.com,1999:blog-8785437776394405849.post-5492974905335204991
blogger_orig_url: http://gkos-hw.blogspot.com/2009/12/listen-for-browser.html
---

<pre class="brush: c">#include &lt;string.h&gt;<br />#include &lt;errno.h&gt;<br />#include &lt;unistd.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;stdio.h&gt;<br />#include &lt;netdb.h&gt;<br />#include &lt;sys/types.h&gt;<br />#include &lt;sys/socket.h&gt;<br />#include &lt;netinet/in.h&gt;<br /><br /><br />int<br />main (int argc, char ** argv)<br />{<br />  char * html, buf[BUFSIZ];<br />  int socket_fd, ret_status, sock_client_fd, pid;<br />  struct sockaddr_in socket_name, sock_client;<br />  struct hostent * host_info;<br /><br />  /* Create a socket */<br />  socket_fd = socket (PF_INET, SOCK_STREAM, 0);<br /><br />  /* Store the socket name at socket addres */<br />  socket_name.sin_family = AF_INET;<br /><br />  /* addr of server (me) */<br />  // socket_name.sin_addr.s_addr = INADDR_ANY;<br />  inet_aton (argv[1], & socket_name.sin_addr.s_addr);<br /><br />  /* use port 80 */<br />  socket_name.sin_port = htons (80);<br /><br />  /* bind socket to an addr */<br />  ret_status = bind (socket_fd, (struct sockaddr *) & socket_name, <br />      sizeof (socket_name));<br />  if (ret_status == -1) {<br /> perror ("bind");<br /> return -1;<br />  }<br />  printf ("binded\n");<br />  /* listen for connections */<br />  listen (socket_fd, 3);<br />  printf ("listen\n");<br /><br />  /* accept new connections */<br />  ret_status = (int) sizeof sock_client;<br />  while ((sock_client_fd = accept (socket_fd, (struct sockaddr *) & sock_client, <br />           & ret_status)) &gt; 0) {<br /><br />   /* print the ip of client */<br />   printf ("\n\nreceived connection from %s\n", inet_ntoa (sock_client.sin_addr.s_addr));<br /><br />   /* wait GET */<br />   printf ("reading from client\n");<br />   while ((ret_status = read (sock_client_fd, buf, BUFSIZ)) &gt; 0) {<br />  write (1, buf, ret_status);<br />  if ((strstr (buf, "GET")) != NULL)<br />    break;<br />   }<br />   if (ret_status == -1) {<br />  perror ("reading from browser");<br />  return -1;<br />   }<br /><br />   /* send an ok */ <br />   printf ("sending DATA\n");<br />   html = <br />  "HTTP/1.1 200 OK\n"<br />  "Accept-Ranges: Bytes\n"<br />  "Content-Length: 76\n"<br />  "Content-Type: text/html; charset=UTF-8\n"<br />  "\n"<br />  "&lt;html&gt;"<br />  "&lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;"<br />  "&lt;body&gt;Hello World&lt;/body&gt;"<br />  "&lt;/html&gt;";<br /><br />   ret_status = write (sock_client_fd, html, strlen (html));<br />   if (ret_status == -1) {<br />  perror ("sending ok");<br />  return -1;<br />   }<br /><br />  }<br /><br />  return 0;<br />}<br /><br /></pre>alias getmyip='sudo ifconfig eth0 | grep -w addr | cut -f2 -d: | cut -f1 -d" "'<br />compile: gcc -o listen-browser listen-browser.c<br />run sudo ./listen-browser $(getmyip)<br />this doesn't work properly yet, I just post to save the code (: